this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,i,l,a,o,r){"use strict";let n=e=>e,b,c;const d="save";const v="cancel";const p="skip";var u=babelHelpers.classPrivateFieldLooseKey("timeline");var P=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var h=babelHelpers.classPrivateFieldLooseKey("entityId");var B=babelHelpers.classPrivateFieldLooseKey("entityStageId");var L=babelHelpers.classPrivateFieldLooseKey("stageIdField");var F=babelHelpers.classPrivateFieldLooseKey("finalStages");var H=babelHelpers.classPrivateFieldLooseKey("allowCloseSlider");var y=babelHelpers.classPrivateFieldLooseKey("isSkipped");var I=babelHelpers.classPrivateFieldLooseKey("popup");var f=babelHelpers.classPrivateFieldLooseKey("toDoEditor");var O=babelHelpers.classPrivateFieldLooseKey("skipProvider");var T=babelHelpers.classPrivateFieldLooseKey("skipMenu");var g=babelHelpers.classPrivateFieldLooseKey("bindEvents");var C=babelHelpers.classPrivateFieldLooseKey("getSliderInstance");var S=babelHelpers.classPrivateFieldLooseKey("onCloseSlider");var _=babelHelpers.classPrivateFieldLooseKey("onEntityUpdate");var m=babelHelpers.classPrivateFieldLooseKey("onEntityModelChange");var D=babelHelpers.classPrivateFieldLooseKey("onSkippedPeriodChange");var w=babelHelpers.classPrivateFieldLooseKey("onToolbarMenuBuild");var A=babelHelpers.classPrivateFieldLooseKey("onChangeDescription");var E=babelHelpers.classPrivateFieldLooseKey("onSaveHotkeyPressed");var K=babelHelpers.classPrivateFieldLooseKey("onSkipMenuItemSelect");var N=babelHelpers.classPrivateFieldLooseKey("saveTodo");var j=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var M=babelHelpers.classPrivateFieldLooseKey("closePopup");var k=babelHelpers.classPrivateFieldLooseKey("closeSlider");var R=babelHelpers.classPrivateFieldLooseKey("showTodoCreationNotification");var X=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var V=babelHelpers.classPrivateFieldLooseKey("getPopupDescription");var Y=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var x=babelHelpers.classPrivateFieldLooseKey("getPopupButtons");var W=babelHelpers.classPrivateFieldLooseKey("getSkipMenuItems");var G=babelHelpers.classPrivateFieldLooseKey("showCancelNotificationInParentWindow");class U{constructor(e){Object.defineProperty(this,G,{value:ue});Object.defineProperty(this,W,{value:pe});Object.defineProperty(this,x,{value:ve});Object.defineProperty(this,Y,{value:de});Object.defineProperty(this,V,{value:ce});Object.defineProperty(this,X,{value:be});Object.defineProperty(this,R,{value:ne});Object.defineProperty(this,k,{value:re});Object.defineProperty(this,M,{value:oe});Object.defineProperty(this,j,{value:ae});Object.defineProperty(this,N,{value:le});Object.defineProperty(this,K,{value:ie});Object.defineProperty(this,E,{value:te});Object.defineProperty(this,A,{value:se});Object.defineProperty(this,w,{value:ee});Object.defineProperty(this,D,{value:Z});Object.defineProperty(this,m,{value:Q});Object.defineProperty(this,_,{value:J});Object.defineProperty(this,S,{value:z});Object.defineProperty(this,C,{value:q});Object.defineProperty(this,g,{value:$});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:false});Object.defineProperty(this,y,{writable:true,value:false});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.entityStageId;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.stageIdField;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.finalStages;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e.skipPeriod;if(BX.CrmTimelineManager){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=BX.CrmTimelineManager.getDefault()}babelHelpers.classPrivateFieldLooseBase(this,g)[g]();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new o.TodoNotificationSkip({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onSkippedPeriodChange:babelHelpers.classPrivateFieldLooseBase(this,D)[D].bind(this)});babelHelpers.classPrivateFieldLooseBase(this,T)[T]=new r.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],selectedValue:e.skipPeriod})}}function $(){if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]()){t.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,C)[C](),"SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,S)[S].bind(this));t.EventEmitter.subscribe("Crm.EntityModel.Change",babelHelpers.classPrivateFieldLooseBase(this,m)[m].bind(this));t.EventEmitter.subscribe("onCrmEntityUpdate",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}t.EventEmitter.subscribe("Crm.InterfaceToolbar.MenuBuild",babelHelpers.classPrivateFieldLooseBase(this,w)[w].bind(this))}function q(){if(top.BX&&top.BX.SidePanel){const e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){return e}}return null}function z(e){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]||babelHelpers.classPrivateFieldLooseBase(this,y)[y]){return}const[s]=e.getCompatData();if(s.getSlider()!==top.BX.SidePanel.Instance.getSliderByWindow(window)){return}if(!s.isActionAllowed()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]||babelHelpers.classPrivateFieldLooseBase(this,u)[u].hasScheduledItems()){return}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].indexOf(babelHelpers.classPrivateFieldLooseBase(this,B)[B])>-1){return}s.denyAction();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}),100)}function J(e){const[s]=e.getCompatData();if(s.hasOwnProperty("entityData")&&s.entityData.hasOwnProperty(babelHelpers.classPrivateFieldLooseBase(this,L)[L])){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.entityData[babelHelpers.classPrivateFieldLooseBase(this,L)[L]]}}function Q(e){const[s,t]=e.getCompatData();if(t.fieldName===babelHelpers.classPrivateFieldLooseBase(this,L)[L]){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.getStringField(babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,B)[B])}}function Z(e){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e}function ee(e){const[,{items:s}]=e.getData();s.push({delimiter:true});for(const e of babelHelpers.classPrivateFieldLooseBase(this,T)[T].getItems()){s.push(e)}}function se(e){var s;const{description:t}=e.getData();const i=(s=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:s.getButton(d);if(!t.length&&!i.getState()){i.setState(a.ButtonState.DISABLED)}else if(t.length&&i.getState()===a.ButtonState.DISABLED){i.setState(null)}}function te(e){var s;const t=(s=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:s.getButton(d);if(!t.getState()){babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}}function ie(e){var s,t,i,l,o,r,n,b,c;(s=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(t=s.getButton(p))==null?void 0:(i=t.getMenuWindow())==null?void 0:i.close();(l=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(o=l.getButton(d))==null?void 0:o.setState(a.ButtonState.DISABLED);(r=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(n=r.getButton(v))==null?void 0:n.setState(a.ButtonState.DISABLED);(b=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(c=b.getButton(p))==null?void 0:c.setState(a.ButtonState.WAITING);babelHelpers.classPrivateFieldLooseBase(this,O)[O].saveSkippedPeriod(e).then((()=>{var s;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=!!e;babelHelpers.classPrivateFieldLooseBase(this,T)[T].setSelectedValue(e);babelHelpers.classPrivateFieldLooseBase(this,j)[j]();babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;babelHelpers.classPrivateFieldLooseBase(this,G)[G]();(s=babelHelpers.classPrivateFieldLooseBase(this,C)[C]())==null?void 0:s.close()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}))}function le(){var e,s,t,i,l,o;(e=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(s=e.getButton(d))==null?void 0:s.setState(a.ButtonState.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(i=t.getButton(v))==null?void 0:i.setState(a.ButtonState.DISABLED);(l=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(o=l.getButton(p))==null?void 0:o.setState(a.ButtonState.DISABLED);babelHelpers.classPrivateFieldLooseBase(this,f)[f].save().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,j)[j]();if(!(e.hasOwnProperty("errors")&&e.errors.length)){var s;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;babelHelpers.classPrivateFieldLooseBase(this,M)[M]();(s=babelHelpers.classPrivateFieldLooseBase(this,C)[C]())==null?void 0:s.close()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}))}function ae(){var e,s,t,i,l,a;(e=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(s=e.getButton(d))==null?void 0:s.setState(null);(t=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(i=t.getButton(v))==null?void 0:i.setState(null);(l=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:(a=l.getButton(p))==null?void 0:a.setState(null)}function oe(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:e.close()}function re(){var e;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;(e=babelHelpers.classPrivateFieldLooseBase(this,C)[C]())==null?void 0:e.close()}function ne(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const l=e.getPropertyValue("--ui-color-base-solid")||"#000000";babelHelpers.classPrivateFieldLooseBase(this,I)[I]=i.PopupManager.create({id:"todo-create-confirm-"+babelHelpers.classPrivateFieldLooseBase(this,P)[P]+"-"+babelHelpers.classPrivateFieldLooseBase(this,h)[h],closeIcon:true,padding:t,overlay:{opacity:40,backgroundColor:l},content:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](),buttons:babelHelpers.classPrivateFieldLooseBase(this,x)[x](),width:545,events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this)},className:"crm-activity__todo-create-notification-popup"})}babelHelpers.classPrivateFieldLooseBase(this,I)[I].show();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f].setFocused()}),10);setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I].setClosingByEsc(true)}),300)}function be(){return s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_TITLE")}function ce(){let e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION";switch(babelHelpers.classPrivateFieldLooseBase(this,P)[P]){case BX.CrmEntityType.enumeration.lead:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD";break;case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL";break}return s.Loc.getMessage(e)}function de(){const e=s.Tag.render(b||(b=n`<div></div>`));const t=s.Tag.render(c||(c=n`<div class="crm-activity__todo-create-notification">
			<div class="crm-activity__todo-create-notification_title">${0}</div>
			<div class="crm-activity__todo-create-notification_content">
				<div class="crm-activity__todo-create-notification_description">${0}</div>
				${0}
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,X)[X](),babelHelpers.classPrivateFieldLooseBase(this,V)[V](),e);babelHelpers.classPrivateFieldLooseBase(this,f)[f]=new l.TodoEditor({container:e,ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,P)[P],ownerId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],events:{onChangeDescription:babelHelpers.classPrivateFieldLooseBase(this,A)[A].bind(this),onSaveHotkeyPressed:babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this)},borderColor:l.TodoEditor.BorderColor.PRIMARY});babelHelpers.classPrivateFieldLooseBase(this,f)[f].show();return t}function ve(){return[new a.SaveButton({id:d,round:true,state:babelHelpers.classPrivateFieldLooseBase(this,f)[f].getDescription()?null:a.ButtonState.DISABLED,events:{click:babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this)}}),new a.CancelButton({text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL"),color:a.ButtonColor.LIGHT_BORDER,id:v,round:true,events:{click:babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this)}}),new a.Button({text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP"),color:a.ButtonColor.LINK,id:p,dropdown:true,menu:{closeByEsc:true,items:babelHelpers.classPrivateFieldLooseBase(this,W)[W](),minWidth:233}})]}function pe(){const e=[];e.push({id:"day",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY"),onclick:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this,"day")});e.push({id:"week",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK"),onclick:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this,"week")});e.push({id:"month",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH"),onclick:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this,"month")});e.push({id:"forever",text:s.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER"),onclick:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this,"forever")});return e}function ue(){if(top.BX&&top.BX.Runtime){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P];top.BX.Runtime.loadExtension("crm.activity.todo-notification-skip").then((s=>{const t=new s.TodoNotificationSkip({entityTypeId:e});t.showCancelPeriodNotification()}))}}e.TodoCreateNotification=U})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX,BX.Event,BX.Main,BX.Crm.Activity,BX.UI,BX.Crm.Activity,BX.Crm.Activity);
//# sourceMappingURL=todo-create-notification.bundle.map.js