this.BX=this.BX||{};(function(e,s,t,i,r,a,l){"use strict";function o(e,s,t){if(l.Type.isNil(e)){return e}return n(e,s,t)}function n(e,s,t){if(e instanceof s){return e}throw new Error(`Expected ${t} be an instance of ${s.name}, got ${c(e)} instead`)}function b(e,s){if(l.Type.isStringFilled(e)||l.Type.isNil(e)){return e}throw new Error(`Expected ${s} be either non-empty string or null, got ${c(e)} instead`)}function c(e){if(l.Type.isObject(e)&&!l.Type.isPlainObject(e)){var s;return(e==null?void 0:(s=e.constructor)==null?void 0:s.name)||"unknown"}return typeof e}const d=l.Reflection.getClass("BX.CrmEntityType");const u="menu-popup-item-accept";const p="menu-popup-item-none";var v=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var h=babelHelpers.classPrivateFieldLooseKey("rootMenu");var P=babelHelpers.classPrivateFieldLooseKey("targetItemId");var y=babelHelpers.classPrivateFieldLooseKey("controller");var T=babelHelpers.classPrivateFieldLooseKey("restriction");var L=babelHelpers.classPrivateFieldLooseKey("todoSkipMenu");var f=babelHelpers.classPrivateFieldLooseKey("isSetSortRequestRunning");var B=babelHelpers.classPrivateFieldLooseKey("bindEvents");var H=babelHelpers.classPrivateFieldLooseKey("shouldShowPushCrmSettings");var g=babelHelpers.classPrivateFieldLooseKey("getItems");var F=babelHelpers.classPrivateFieldLooseKey("shouldShowLastActivitySortToggle");var S=babelHelpers.classPrivateFieldLooseKey("getLastActivitySortToggle");var m=babelHelpers.classPrivateFieldLooseKey("isLastActivitySortEnabled");var I=babelHelpers.classPrivateFieldLooseKey("handleLastActivitySortToggleClick");var C=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoSkipMenu");class E{constructor(e){Object.defineProperty(this,C,{value:R});Object.defineProperty(this,I,{value:K});Object.defineProperty(this,m,{value:j});Object.defineProperty(this,S,{value:A});Object.defineProperty(this,F,{value:O});Object.defineProperty(this,g,{value:w});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,B,{value:M});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,v)[v]=l.Text.toInteger(e.entityTypeId);if(d&&!d.isDefined(babelHelpers.classPrivateFieldLooseBase(this,v)[v])){throw new Error(`Provided entityTypeId is invalid: ${babelHelpers.classPrivateFieldLooseBase(this,v)[v]}`)}babelHelpers.classPrivateFieldLooseBase(this,h)[h]=n(e.rootMenu,i.Menu,"params.rootMenu");babelHelpers.classPrivateFieldLooseBase(this,P)[P]=b(e.targetItemId,"params.targetItemId");babelHelpers.classPrivateFieldLooseBase(this,y)[y]=o(e.controller,r.SettingsController,"params.controller");babelHelpers.classPrivateFieldLooseBase(this,T)[T]=o(e.restriction,a.Restriction,"params.restriction");babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new t.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,v)[v],selectedValue:b(e.todoCreateNotificationSkipPeriod,"params.todoCreateNotificationSkipPeriod")});babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}}function M(){const e=t=>{const i=t.getTarget();if(i.getId()!==babelHelpers.classPrivateFieldLooseBase(this,h)[h].getId()){return}s.EventEmitter.unsubscribe(s.EventEmitter.GLOBAL_TARGET,"onPopupShow",e);if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H]()){return}const r=babelHelpers.classPrivateFieldLooseBase(this,h)[h].addMenuItem({text:l.Loc.getMessage("CRM_PUSH_CRM_SETTINGS_MENU_ITEM_TEXT"),items:[{id:"stub"}]},babelHelpers.classPrivateFieldLooseBase(this,P)[P]);r.subscribe("SubMenu:onShow",(e=>{var s;const t=e.getTarget();for(const e of babelHelpers.classPrivateFieldLooseBase(this,g)[g]()){var i;(i=t.getSubMenu())==null?void 0:i.addMenuItem(e)}(s=t.getSubMenu())==null?void 0:s.removeMenuItem("stub")}))};s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"onPopupShow",e)}function _(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]().length>0}function w(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]()){e.push(babelHelpers.classPrivateFieldLooseBase(this,S)[S]())}if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,L)[L].getItems())}return e}function O(){var e,s;return!!((e=babelHelpers.classPrivateFieldLooseBase(this,y)[y])!=null&&e.getCurrentSettings().isTypeSupported(r.Type.BY_LAST_ACTIVITY_TIME)&&(s=babelHelpers.classPrivateFieldLooseBase(this,T)[T])!=null&&s.isSortTypeChangeAvailable())}function A(){return{text:l.Loc.getMessage("CRM_PUSH_CRM_SETTINGS_SORT_TOGGLE_TEXT"),disabled:babelHelpers.classPrivateFieldLooseBase(this,f)[f],className:babelHelpers.classPrivateFieldLooseBase(this,m)[m]()?u:p,onclick:babelHelpers.classPrivateFieldLooseBase(this,I)[I].bind(this)}}function j(){var e;return((e=babelHelpers.classPrivateFieldLooseBase(this,y)[y])==null?void 0:e.getCurrentSettings().getCurrentType())===r.Type.BY_LAST_ACTIVITY_TIME}function K(e,s){var t,i;(t=s.getMenuWindow())==null?void 0:(i=t.getRootMenuWindow())==null?void 0:i.close();s.disable();if(babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return}babelHelpers.classPrivateFieldLooseBase(this,f)[f]=true;const a=babelHelpers.classPrivateFieldLooseBase(this,y)[y].getCurrentSettings();let l;if(a.getCurrentType()===r.Type.BY_LAST_ACTIVITY_TIME){l=a.getSupportedTypes().find((e=>e!==r.Type.BY_LAST_ACTIVITY_TIME))}else{l=r.Type.BY_LAST_ACTIVITY_TIME}babelHelpers.classPrivateFieldLooseBase(this,y)[y].setCurrentSortType(l).then((()=>{})).catch((()=>{})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f]=false;s.enable()}))}function R(){let e=[];if(d){e=[d.enumeration.deal]}return e.includes(babelHelpers.classPrivateFieldLooseBase(this,v)[v])}const X=l.Reflection.namespace("BX.Crm");X.PushCrmSettings=E;e.PushCrmSettings=E})(this.BX.Crm=this.BX.Crm||{},BX.Event,BX.Crm.Activity,BX.Main,BX.CRM.Kanban,BX.CRM.Kanban,BX);
//# sourceMappingURL=push-crm-settings.bundle.map.js