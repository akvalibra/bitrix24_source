this.BX=this.BX||{};(function(e,t,n,r,i,a){"use strict";var o=t.Reflection.namespace("BX.Crm");var s=null;var l=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(l,"TYPE_UPDATED","TypeUpdated");babelHelpers.defineProperty(l,"CATEGORIES_UPDATED","CategoriesUpdated");var u=function(e){babelHelpers.inherits(n,e);function n(){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));e.initHints();e.setEventNamespace("BX.Crm.ToolbarComponent");t.Event.ready(e.bindEvents.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(n,[{key:"initHints",value:function e(){BX.UI.Hint.init(BX("ui-toolbar-after-title-buttons"));BX.UI.Hint.popupParameters={closeByEsc:true,autoHide:true,angle:{offset:60},offsetLeft:40}}},{key:"bindEvents",value:function e(){var n=this;var r=document.querySelector('[data-role="bx-crm-toolbar-categories-button"]');if(r){var i=BX.UI.ToolbarManager.getDefaultToolbar();var a=i.getButton(t.Dom.attr(r,"data-btn-uniqid"));var o=Number(r.dataset.entityTypeId);if(a&&o>0){this.subscribeCategoriesUpdatedEvent((function(){n.reloadCategoriesMenu(a,o,r.dataset.categoryId)}))}}}},{key:"emitTypeUpdatedEvent",value:function e(t){this.emit(l.TYPE_UPDATED,t)}},{key:"emitCategoriesUpdatedEvent",value:function e(t){this.emit(l.CATEGORIES_UPDATED,t)}},{key:"subscribeTypeUpdatedEvent",value:function e(t){this.subscribe(l.TYPE_UPDATED,t)}},{key:"subscribeCategoriesUpdatedEvent",value:function e(t){this.subscribe(l.CATEGORIES_UPDATED,t)}},{key:"reloadCategoriesMenu",value:function e(n,r,o){var s=n.getMenuWindow();if(!s){return}t.ajax.runAction("crm.controller.category.list",{data:{entityTypeId:r}}).then((function(e){var l=0;var u=[];var c=e.data.categories;s.menuItems.forEach((function(e){if(e.id.indexOf("toolbar-category-")!==0){u.push(e.options)}else if(e.id==="toolbar-category-all"){u.push(e.options);l=1}}));s.destroy();t.Event.unbindAll(n.getContainer(),"click");c.forEach((function(e){var a;if(r===BX.CrmEntityType.enumeration.deal){a="/crm/deal/category/"+e.id+"/"}else{a=i.Router.Instance.getItemListUrlInCurrentView(r,e.id);a=a.toString()}u.splice(l,0,{id:"toolbar-category-"+e.id,text:t.Text.encode(e.name),href:a?a:null});if(e.id>0&&o>0&&Number(o)===Number(e.id)){n.setText(t.Text.encode(e.name))}l++}));var d=s.params;d.items=u;n.menuWindow=new a.Menu(d);t.Event.bind(n.getContainer(),"click",n.menuWindow.show.bind(n.menuWindow))}))["catch"]((function(e){console.log("error trying reload categories",e.errors)}))}}],[{key:"Instance",get:function e(){if(window.top!==window&&t.Reflection.getClass("top.BX.Crm.ToolbarComponent")){return window.top.BX.Crm.ToolbarComponent.Instance}if(s===null){s=new n}return s}}]);return n}(n.EventEmitter);o.ToolbarComponent=u})(this.BX.Crm=this.BX.Crm||{},BX,BX.Event,BX.UI,BX.Crm,BX.Main);
//# sourceMappingURL=toolbar-component.bundle.map.js