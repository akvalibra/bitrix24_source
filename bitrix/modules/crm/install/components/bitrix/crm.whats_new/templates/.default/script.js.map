{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Runtime, Dom, Tag, Type, clone } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { EventEmitter } from \"main.core.events\";\n\nconst namespaceCrmWhatsNew = Reflection.namespace('BX.Crm.WhatsNew');\n\ntype SlideConfig = {\n\ttitle: string,\n\tinnerImage: string,\n\tinnerTitle: string,\n\tinnerDescription: string,\n\tbuttons: Array<ButtonConfig>,\n};\n\ntype ButtonConfig = {\n\ttext: string,\n\tclassName: string,\n\tonClickClose: ?boolean,\n\thelpDeskCode: ?string,\n}\n\ntype Slide = {\n\ttitle: string,\n\tclassName: ?string,\n\thtml: string,\n}\n\ntype StepConfig = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\ttarget: ?string,\n\tuseDynamicTarget: ?boolean,\n\teventName: ?string,\n}\n\ntype Step = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\ttarget: ?string,\n}\n\nclass ActionViewMode\n{\n\tslides: Array<Slide>;\n\tsteps: Array<Step>;\n\tcloseOptionName: string;\n\tcloseOptionCategory: string;\n\tpopup;\n\n\tconstructor({ slides, steps, options, closeOptionCategory, closeOptionName })\n\t{\n\t\tthis.popup = null;\n\t\tthis.slides = [];\n\t\tthis.steps = [];\n\t\tthis.options = options;\n\t\tthis.slideClassName = 'crm-whats-new-slides-wrapper';\n\t\tthis.closeOptionCategory = Type.isString(closeOptionCategory) ? closeOptionCategory : '';\n\t\tthis.closeOptionName = Type.isString(closeOptionName) ? closeOptionName : '';\n\t\tthis.onClickClose = this.onClickCloseHandler.bind(this);\n\n\t\tthis.whatNewPromise = null;\n\t\tthis.tourPromise = null;\n\n\t\tthis.prepareSlides(slides);\n\t\tthis.prepareSteps(steps);\n\t}\n\n\tprepareSlides(slideConfigs: Array<SlideConfig>): void\n\t{\n\t\tif (slideConfigs.length)\n\t\t{\n\t\t\tthis.whatNewPromise = Runtime.loadExtension('ui.dialogs.whats-new');\n\t\t}\n\n\t\tthis.slides = slideConfigs.map((slideConfig: SlideConfig) => {\n\t\t\treturn {\n\t\t\t\tclassName: this.slideClassName,\n\t\t\t\ttitle: slideConfig.title,\n\t\t\t\thtml: this.getPreparedSlideHtml(slideConfig),\n\t\t\t};\n\t\t}, this);\n\t}\n\n\tgetPreparedSlideHtml(slideConfig: SlideConfig): HTMLElement\n\t{\n\t\tconst slide = Tag.render`\n\t\t\t<div class=\"crm-whats-new-slide\">\n\t\t\t\t<img src=\"${slideConfig.innerImage}\" alt=\"\">\n\t\t\t\t<div class=\"crm-whats-new-slide-inner-title\"> ${slideConfig.innerTitle} </div>\n\t\t\t\t<p>${slideConfig.innerDescription}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst buttons = this.getPrepareSlideButtons(slideConfig);\n\t\tif (buttons.length)\n\t\t{\n\t\t\tconst buttonsContainer =  Tag.render`<div class=\"crm-whats-new-slide-buttons\"></div>`;\n\t\t\tDom.append(buttonsContainer, slide);\n\n\t\t\tbuttons.forEach(button => {\n\t\t\t\tDom.append(button.getContainer(), buttonsContainer);\n\t\t\t});\n\t\t}\n\n\t\treturn slide;\n\t}\n\n\tgetPrepareSlideButtons(slideConfig: SlideConfig): Button[]\n\t{\n\t\tlet buttons = [];\n\t\tif (slideConfig.buttons)\n\t\t{\n\t\t\tconst className = 'ui-btn ui-btn-primary ui-btn-hover ui-btn-round ';\n\n\t\t\tbuttons = slideConfig.buttons.map((buttonConfig) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tclassName: className + (buttonConfig.className ?? ''),\n\t\t\t\t\ttext: buttonConfig.text,\n\t\t\t\t};\n\n\t\t\t\tif (buttonConfig.onClickClose)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.onClickClose();\n\t\t\t\t}\n\t\t\t\telse if (buttonConfig.helpDeskCode)\n\t\t\t\t{\n\t\t\t\t\tconfig.onclick = () => this.showHelpDesk(buttonConfig.helpDeskCode);\n\t\t\t\t}\n\n\t\t\t\treturn new Button(config);\n\t\t\t}, this);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\tprepareSteps(stepsConfig)\n\t{\n\t\tif (stepsConfig.length)\n\t\t{\n\t\t\tthis.tourPromise = Runtime.loadExtension('ui.tour');\n\t\t}\n\n\t\tthis.steps = stepsConfig.map((stepConfig: StepConfig) => {\n\t\t\tconst step = {\n\t\t\t\tid: stepConfig.id,\n\t\t\t\ttitle: stepConfig.title,\n\t\t\t\ttext: stepConfig.text,\n\t\t\t};\n\n\t\t\tif (stepConfig.useDynamicTarget)\n\t\t\t{\n\t\t\t\tconst eventName = (stepConfig.eventName ?? this.getDefaultStepEventName(step.id));\n\t\t\t\tEventEmitter.subscribeOnce(eventName, this.showStepByEvent.bind(this));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstep.target = stepConfig.target;\n\t\t\t}\n\n\t\t\treturn step;\n\n\t\t}, this);\n\t}\n\n\tshowStepByEvent(event): void\n\t{\n\t\tthis.tourPromise.then((exports) => {\n\t\t\tconst { stepId, target, delay }  = event.data;\n\t\t\tconst step = this.steps.find(step => step.id === stepId);\n\t\t\tif (!step)\n\t\t\t{\n\t\t\t\tconsole.error('step not found');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tstep.target = target;\n\t\t\t\tconst { Guide } = exports;\n\t\t\t\tconst guide = this.createGuideInstance(Guide, [step], true);\n\n\t\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\t\t\t\tguide.showNextStep();\n\t\t\t\tthis.save();\n\n\t\t\t}, delay || 0);\n\t\t});\n\t}\n\n\tgetDefaultStepEventName(stepId: string): string\n\t{\n\t\treturn `Crm.WhatsNew::onTargetSetted::${stepId}`;\n\t}\n\n\tonClickCloseHandler(): void\n\t{\n\t\tconst lastPosition = this.popup.getLastPosition();\n\t\tconst currentPosition = this.popup.getPositionBySlide(this.popup.getCurrentSlide());\n\t\tif (currentPosition >= lastPosition)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.popup.selectNextSlide();\n\t\t}\n\t}\n\n\tshowHelpDesk(code: string): void\n\t{\n\t\tif(top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${code}`);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.slides.length)\n\t\t{\n\t\t\tthis.executeWhatsNew();\n\t\t}\n\t\telse if (this.steps.length)\n\t\t{\n\t\t\tthis.executeGuide();\n\t\t}\n\t}\n\n\texecuteWhatsNew(): void\n\t{\n\t\tif (PopupManager && PopupManager.isAnyPopupShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.whatNewPromise.then(exports => {\n\t\t\tconst { WhatsNew } = exports;\n\t\t\tthis.popup = new WhatsNew({\n\t\t\t\tslides: this.slides,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\theight: 440,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tthis.executeGuide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.popup.show();\n\t\t}, this);\n\t}\n\n\texecuteGuide(): void\n\t{\n\t\tlet steps = clone(this.steps);\n\t\tsteps = steps.filter(step => Boolean(step.target));\n\t\tif (!steps.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tourPromise.then((exports) => {\n\t\t\tconst { Guide } = exports;\n\t\t\tconst guide = this.createGuideInstance(Guide, steps, (this.steps.length <= 1));\n\n\t\t\tthis.setStepPopupOptions(guide.getPopup());\n\n\t\t\tif (guide.steps.length > 1)\n\t\t\t{\n\t\t\t\tguide.start();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tguide.showNextStep();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateGuideInstance(guide, steps: Array<Step>, onEvents: boolean)\n\t{\n\t\treturn new guide({\n\t\t\tonEvents,\n\t\t\tsteps: steps,\n\t\t\tevents: {\n\t\t\t\tonFinish: () => {\n\t\t\t\t\tif (!this.slides.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tsetStepPopupOptions(popup: Popup)\n\t{\n\t\tpopup.setAutoHide(false);\n\n\t\tconst { steps } = this.options;\n\t\tif (steps && steps.popup)\n\t\t{\n\t\t\tif (steps.popup.width)\n\t\t\t{\n\t\t\t\tpopup.setWidth(steps.popup.width)\n\t\t\t}\n\t\t}\n\t}\n\n\tsave(): void\n\t{\n\t\tBX.userOptions.save(this.closeOptionCategory, this.closeOptionName, 'closed', 'Y');\n\t}\n}\n\nnamespaceCrmWhatsNew.ActionViewMode = ActionViewMode;\n"],"names":["namespaceCrmWhatsNew","Reflection","namespace","ActionViewMode","slides","steps","options","closeOptionCategory","closeOptionName","popup","slideClassName","Type","isString","onClickClose","onClickCloseHandler","bind","whatNewPromise","tourPromise","prepareSlides","prepareSteps","slideConfigs","length","Runtime","loadExtension","map","slideConfig","className","title","html","getPreparedSlideHtml","slide","Tag","render","innerImage","innerTitle","innerDescription","buttons","getPrepareSlideButtons","buttonsContainer","Dom","append","forEach","button","getContainer","buttonConfig","config","text","onclick","helpDeskCode","showHelpDesk","Button","stepsConfig","stepConfig","step","id","useDynamicTarget","eventName","getDefaultStepEventName","EventEmitter","subscribeOnce","showStepByEvent","target","event","then","exports","data","stepId","delay","find","console","error","setTimeout","Guide","guide","createGuideInstance","setStepPopupOptions","getPopup","showNextStep","save","lastPosition","getLastPosition","currentPosition","getPositionBySlide","getCurrentSlide","destroy","selectNextSlide","code","top","BX","Helper","show","preventDefault","executeWhatsNew","executeGuide","PopupManager","isAnyPopupShown","WhatsNew","popupOptions","height","events","onDestroy","clone","filter","Boolean","start","onEvents","onFinish","setAutoHide","width","setWidth","userOptions"],"mappings":"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"}