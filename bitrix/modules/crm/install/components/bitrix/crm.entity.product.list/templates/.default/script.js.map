{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Tag, Text, Loc, Event, Cache, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#model = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\n\tconstructor(options)\n\t{\n\t\tthis.#model = options.model;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#model.getOption('id') === null // is new row\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tnode.appendChild(\n\t\t\tTag.render`<div>${this.#getReserveInputNode()}</div>`\n\t\t);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tnode.appendChild(this.#getDateNode());\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#model.getField(this.dateFieldName) || null;\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tif (this.getDateReservation() === null)\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(this.#model.getField(this.dateFieldName));\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.#model.setField(this.inputFieldName, value);\n\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.inputFieldName,\n\t\t\tVALUE: value,\n\t\t})\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled()\n\t{\n\t\treturn this.isBlocked\n\t\t\t|| this.#model.isSimple()\n\t\t\t|| this.#model.isEmpty()\n\t\t;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: ?string = null)\n\t{\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.dateFieldName,\n\t\t\tVALUE: date,\n\t\t})\n\n\t\tthis.#model.setField(this.dateFieldName, date);\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: ?string = null): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === null)\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Uri } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tthis.#node.classList.add('store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\trefreshStoreInfo()\n\t{\n\t\tthis.#model.getStoreCollection().refresh();\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(availableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleFocusUnchangeablePrice = this.#showChangePriceNotify.bind(this);\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\thandleOnGridUpdated = this.#onGridUpdated.bind(this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.refreshFieldsLayout();\n\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tclearChanges()\n\t{\n\t\tthis.getModel().clearChangedList();\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.reserveControl)\n\t\t{\n\t\t\tEventEmitter.unsubscribeAll(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onChange'\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tpriceNode.setAttribute('disabled', true);\n\t\t\tDom.addClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.setAttribute('disabled', 'true')\n\t\t\t;\n\t\t\tif (!this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t\t{\n\t\t\t\tEvent.bind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpriceNode.removeAttribute('disabled');\n\t\t\tDom.removeClass(priceNode,'ui-ctl-element');\n\t\t\tpriceNode\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\n\t\t\t\t?.removeAttribute('disabled')\n\t\t\t;\n\t\t\tEvent.unbind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\n\t\t}\n\t}\n\n\t#showChangePriceNotify()\n\t{\n\t\tif (this.editor.getSettingValue('disableNotifyChangingPrice'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hint = Text.encode(this.editor.getSettingValue('catalogPriceEditArticleHint'));\n\n\t\tconst changePriceNotifyId = 'disabled-crm-changing-price';\n\t\tlet changePriceNotify = BX.UI.Notification.Center.getBalloonById(changePriceNotifyId);\n\t\tif (!changePriceNotify)\n\t\t{\n\t\t\tconst content = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div style=\"padding: 9px\">${hint}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst buttonRow = Tag.render`<div></div>`;\n\t\t\tcontent.appendChild(buttonRow);\n\n\t\t\tconst articleCode = this.editor.getSettingValue('catalogPriceEditArticleCode');\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tconst moreLink = Tag.render`\n\t\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_MORE_LINK')}\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\tEvent.bind(moreLink, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=\" + articleCode);\n\t\t\t\t\tchangePriceNotify.close();\n\t\t\t\t});\n\t\t\t\tbuttonRow.appendChild(moreLink);\n\t\t\t}\n\n\t\t\tconst disableNotificationLink = Tag.render`\n\t\t\t\t<span class=\"ui-notification-balloon-action\">\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_DISABLE_NOTIFICATION')}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tEvent.bind(disableNotificationLink, 'click', () => {\n\t\t\t\tchangePriceNotify.close();\n\t\t\t\tthis.editor.setSettingValue('disableNotifyChangingPrice', true);\n\t\t\t\tajax\n\t\t\t\t\t.runComponentAction(\n\t\t\t\t\t\tthis.editor.getComponentName(),\n\t\t\t\t\t\t'setGridSetting',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tsignedParameters: this.editor.getSignedParameters(),\n\t\t\t\t\t\t\t\tsettingId: 'DISABLE_NOTIFY_CHANGING_PRICE',\n\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t});\n\n\t\t\tbuttonRow.appendChild(disableNotificationLink);\n\n\t\t\tconst notificationOptions = {\n\t\t\t\tid: changePriceNotifyId,\n\t\t\t\tcloseButton: true,\n\t\t\t\tcategory: Row.CATALOG_PRICE_CHANGING_DISABLED,\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcontent,\n\t\t\t};\n\n\t\t\tchangePriceNotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t}\n\n\t\tchangePriceNotify.show();\n\t}\n\n\t#isEditableCatalogPrice()\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice()\n\t{\n\t\treturn this.editor.canSaveCatalogPrice()\n\t\t\t|| (this.getModel().isCatalogExisted() && this.getModel().isNew())\n\t\t;\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\tif (this.isReserveBlocked())\n\t\t\t{\n\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t});\n\n\t\t// runs once because after grid update, row re-created.\n\t\tEventEmitter.subscribeOnce(\n\t\t\t'Grid::updated',\n\t\t\tthis.handleOnGridUpdated\n\t\t);\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tstoreSearchInput.getNameInput().classList.add('crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tthis.storeSelector.getWrapper().onclick = () => this.editor.openIntegrationLimitSlider();\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\tmodel: this.getModel(),\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onChange',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst item = event.getData();\n\t\t\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear(event)\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tlet fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetEnteredPrice(): number\n\t{\n\t\treturn this.getField('ENTERED_PRICE', this.getBasePrice());\n\t}\n\n\tgetCatalogPrice(): number\n\t{\n\t\treturn this.getField('CATALOG_PRICE', this.getBasePrice());\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'PRICE':\n\t\t\t\tthis.changeEnteredPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'CATALOG_PRICE':\n\t\t\t\tthis.changeCatalogPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.setBasePrice(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeEnteredPrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setField('ENTERED_PRICE', preparedValue);\n\t\tif (mode === MODE_EDIT && originalPrice >= 0)\n\t\t{\n\t\t\tif (!this.#isEditableCatalogPrice)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.getModel().isCatalogExisted() && this.#isSaveableCatalogPrice())\n\t\t\t{\n\t\t\t\tthis.#showPriceNotifier(preparedValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setBasePrice(preparedValue, mode);\n\t\t\t}\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t\tthis.addActionDisableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.refreshFieldsLayout();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tchangeCatalogPrice(value)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('CATALOG_PRICE', preparedValue);\n\t\tthis.refreshFieldsLayout();\n\t}\n\n\t#showPriceNotifier(enteredPrice)\n\t{\n\t\tconst disabledPriceNotify = BX.UI.Notification.Center.getBalloonByCategory(Row.CATALOG_PRICE_CHANGING_DISABLED);\n\t\tif (disabledPriceNotify)\n\t\t{\n\t\t\tdisabledPriceNotify.close();\n\t\t}\n\t\tthis.getModel().showSaveNotifier(\n\t\t\t'priceChanger_' + this.getId(),\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_PRICE_CHANGED_QUERY'),\n\t\t\t\tevents: {\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tif (this.getBasePrice() > this.getEnteredPrice())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setField('ENTERED_PRICE', this.getBasePrice());\n\t\t\t\t\t\t\tthis.updateUiInputField('PRICE', this.getBasePrice())\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setPrice(enteredPrice);\n\n\t\t\t\t\t\tif (this.getField('DISCOUNT_SUM') > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst settingPopup = this.getEditor().getSettingsPopup();\n\t\t\t\t\t\t\tconst setting = settingPopup?.getSetting('DISCOUNTS');\n\t\t\t\t\t\t\tif (setting && setting.checked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsettingPopup.requestGridSettings(setting, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\tthis.setField('ENTERED_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setField('PRICE', enteredPrice);\n\t\t\t\t\t\tthis.changeCatalogPrice('CATALOG_PRICE', enteredPrice);\n\t\t\t\t\t\tthis.setBasePrice(enteredPrice);\n\t\t\t\t\t\tthis.getModel().save(['BASE_PRICE', 'CURRENCY']);\n\n\t\t\t\t\t\tthis.refreshFieldsLayout();\n\t\t\t\t\t\tthis.addActionUpdateTotal();\n\t\t\t\t\t\tthis.executeExternalActions();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tconst taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(this.parseFloat(taxRate.VALUE));\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number): void\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.addActionProductChange();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tconst storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow())\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount && this.storeSelector)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\tavailableWrapper.innerHTML = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavailableWrapper.innerHTML = Text.toNumber(available) + ' ' + Text.encode(measureName);\n\t\t}\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + Text.encode(measureName);\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + Text.encode(measureName);\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference == 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\n\t\t\tif (Type.isObject(imageInfo))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (this.#isReserveEqualProductQuantity())\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\t\t\t\t\tthis.reserveControl?.setReservedQuantity(\n\t\t\t\t\t\tthis.getField('QUANTITY'),\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPrice(value)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tconst calculatedFields = this.getCalculator()\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getBasePrice()))\n\t\t\t.calculatePrice(value)\n\t\t;\n\n\t\tdelete(calculatedFields['BASE_PRICE']);\n\t\tthis.setFields(calculatedFields);\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t\tthis.executeExternalActions();\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tconst calculatedFields = this.getCalculator()\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getCatalogPrice()))\n\t\t\t.calculatePrice(value)\n\t\t;\n\n\t\tthis.setFields(calculatedFields);\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t\tthis.#togglePriceHintPopup(originalPrice !== value);\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE', 'ENTERED_PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE' || field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_NETTO':\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'ENTERED_PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field)\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tthis.onAfterExecuteExternalActions.call();\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t}\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked()\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#onGridUpdated(): void\n\t{\n\t\tif (this.storeAvailablePopup)\n\t\t{\n\t\t\tthis.storeAvailablePopup.refreshStoreInfo();\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).bind(this);\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'ENTERED_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'ENTERED_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst product = new Row(rowId, fields, {isReserveBlocked}, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tfields['CATALOG_PRICE'] = fields['BASE_PRICE'];\n\t\t\t\tfields['ENTERED_PRICE'] = fields['BASE_PRICE'];\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeEnteredPrice(0);\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'ENTERED_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper');\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","model","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","getOption","appendChild","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","getAvailableQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","setReservedQuantity","changeDateReservation","setField","EventEmitter","emit","NAME","VALUE","isSimple","isEmpty","newDate","parseDate","current","Date","setHours","date","calendar","field","parentNode","bTime","remember","tag","isInputDisabled","onclick","linkText","link","innerText","hiddenInput","StoreAvailablePopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","rowId","setNode","classList","add","togglePopup","getStoreCollection","refresh","storeId","storeCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","reservedQuantityLink","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","getPopupContent","_classPrivateMethodGet","popupId","popup","PopupManager","getPopupById","create","bindElement","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MODE_EDIT","MODE_SET","Row","fields","settings","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","refreshFieldsLayout","requestAnimationFrame","initHandlers","cache","getEditorContainer","mainSelector","getModel","clearChangedList","isNaN","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","reserveControl","unsubscribeAll","handleChangeStoreData","handleProductErrorsChange","priceNode","setAttribute","Dom","addClass","getSettingValue","handleFocusUnchangeablePrice","removeAttribute","removeClass","unbind","storeWrapper","innerHTML","clearCache","renderTo","number","textContent","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeEnteredPrice","changeCatalogPrice","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","setBasePrice","setDeductedQuantity","setRowReserved","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","originalPrice","Math","max","parseFloat","getPricePrecision","isCatalogExisted","addActionProductChange","addActionUpdateTotal","addActionDisableSaveButton","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","setTaxRate","isBoolean","setRowSum","isChangedValue","isReserveBlocked","updateUiStoreAmountData","availableWrapper","available","measureName","getDefaultMeasure","SYMBOL","reserveWrapper","deductedWrapper","isNil","reserveDifference","newReserve","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","subscribe","setOption","resetReserveFields","onAfterExecuteExternalActions","calculatedFields","calculateBasePrice","calculatePrice","getCatalogPrice","updateUiInputField","exceptFieldNames","calculateQuantity","isElementNode","measure","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","selectItem","dataset","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","call","trim","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","disabled","products","PopupMenu","items","append","hint","changePriceNotifyId","changePriceNotify","buttonRow","articleCode","moreLink","top","Helper","disableNotificationLink","setSettingValue","ajax","runComponentAction","getComponentName","data","signedParameters","getSignedParameters","settingId","selected","category","CATALOG_PRICE_CHANGING_DISABLED","canEditCatalogPrice","canSaveCatalogPrice","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","URL_BUILDER_CONTEXT","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","StoreSelector","inputFieldId","inputFieldTitle","storeAvaiableNode","storeAvailablePopup","subscribeOnce","handleOnGridUpdated","storeSearchInput","searchInput","getNameInput","toggleIcon","getSearchIcon","getWrapper","openIntegrationLimitSlider","getData","layoutReserveControl","quantityInput","setReserveQuantity","initHandlersForSelectors","enteredPrice","disabledPriceNotify","getBalloonByCategory","onCancel","getEnteredPrice","setPrice","settingPopup","getSettingsPopup","setting","getSetting","requestGridSettings","isNewRow","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","showNegative","load","refreshStoreInfo","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","currentHeaders","then","message","panel","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","Hint","init","Slider","url","settingItem","settingEnabled","stack","width","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","Map","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnSave","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","container","headerId","hasClass","lock","insertBefore","firstChild","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onSaveHandler","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","callback","command","getCompatData","getProductCount","addProductRow","selectProductInRow","getProductSelector","onProductSelect","product","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","actionUpdateTotalData","isInternalChanging","panelCode","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","remove","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","zIndex","defer","Get","style","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","focusProductSelector","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","Object","assign","taxId","taxIncluded","keys","key","tableUnfade","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","setTimeout","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","sort","a","b","InfoHelper","helperSlider","getSlider","slider","location","search","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}